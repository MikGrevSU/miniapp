<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finance Mini App</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#f2f4f8;
 --card:#fff;
 --text:#222;
 --primary:#2a8cff;
 --green:#2ecc71;
 --red:#e74c3c;
 --radius:18px;
}

.dark{
 --bg:#0f172a;
 --card:#1e293b;
 --text:#f1f5f9;
}

*{box-sizing:border-box;font-family:system-ui,-apple-system}

body{
 margin:0;
 background:linear-gradient(180deg,var(--bg),#dbeafe);
 color:var(--text);
 transition:.3s;
}

header{
 padding:18px;
 font-size:22px;
 font-weight:700;
 text-align:center;
}

main{padding:14px;padding-bottom:90px}

.card{
 background:var(--card);
 border-radius:var(--radius);
 padding:16px;
 margin-bottom:14px;
 box-shadow:0 10px 25px rgba(0,0,0,.05);
 animation:fade .3s ease;
}

@keyframes fade{
 from{opacity:0;transform:translateY(10px)}
 to{opacity:1}
}

.row{display:flex;justify-content:space-between;margin-bottom:6px}

button{
 width:100%;
 padding:14px;
 border:none;
 border-radius:16px;
 background:var(--primary);
 color:white;
 font-size:16px;
}

input,select,textarea{
 width:100%;
 padding:12px;
 border-radius:14px;
 border:1px solid #ccc;
 margin-bottom:10px;
 font-size:15px;
 background:transparent;
 color:var(--text);
}

.toggle{
 display:flex;
 gap:8px;
 margin-bottom:10px;
}

.toggle div{
 flex:1;
 text-align:center;
 padding:12px;
 border-radius:14px;
 background:#e5e7eb;
}

.toggle .active.income{background:rgba(46,204,113,.2);color:var(--green)}
.toggle .active.expense{background:rgba(231,76,60,.2);color:var(--red)}

.bottom{
 position:fixed;
 bottom:0;left:0;right:0;
 display:flex;
 background:var(--card);
 border-top:1px solid #ddd;
}

.bottom button{
 flex:1;
 background:none;
 color:#555;
}

.bottom button.active{color:var(--primary)}

.green{color:var(--green)}
.red{color:var(--red)}
.small{opacity:.6;font-size:13px}
</style>
</head>

<body>

<header>üí∞ –§–∏–Ω–∞–Ω—Å—ã</header>

<main>

<!-- DASHBOARD -->
<section id="dash">
 <div class="card">
  <div class="row"><span>–ë–∞–ª–∞–Ω—Å</span><b id="balance">0</b></div>
  <div class="row small"><span>–î–æ—Ö–æ–¥</span><span id="inc">0</span></div>
  <div class="row small"><span>–†–∞—Å—Ö–æ–¥</span><span id="exp">0</span></div>
 </div>

 <div class="card" id="last"></div>

 <button onclick="openAdd('income')">‚ûï –î–æ—Ö–æ–¥</button>
 <button style="margin-top:8px;background:#ef4444" onclick="openAdd('expense')">‚ûñ –†–∞—Å—Ö–æ–¥</button>
</section>

<!-- ADD -->
<section id="add" style="display:none">
 <div class="card">
  <div class="toggle">
   <div class="income active" onclick="setType('income')">–î–æ—Ö–æ–¥</div>
   <div class="expense" onclick="setType('expense')">–†–∞—Å—Ö–æ–¥</div>
  </div>

  <input id="amount" type="number" placeholder="–°—É–º–º–∞">
  <select id="category"></select>
  <input id="date" type="date">
  <textarea id="note" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ"></textarea>
  <button onclick="saveTx()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
 </div>
</section>

<!-- REPORTS -->
<section id="reports" style="display:none">
 <div class="card"><canvas id="pie"></canvas></div>
 <div class="card"><canvas id="line"></canvas></div>
 <div class="card">
  <div class="row"><span>–î–æ—Ö–æ–¥</span><b class="green" id="rInc">0</b></div>
  <div class="row"><span>–†–∞—Å—Ö–æ–¥</span><b class="red" id="rExp">0</b></div>
  <div class="row"><span>–ò—Ç–æ–≥–æ</span><b id="rBal">0</b></div>
 </div>
</section>

<!-- SETTINGS -->
<section id="settings" style="display:none">
 <div class="card">
  <button onclick="toggleTheme()">üåó –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button>
 </div>
</section>

</main>

<div class="bottom">
 <button class="active" onclick="tab('dash')">üè†</button>
 <button onclick="tab('reports')">üìä</button>
 <button onclick="tab('settings')">‚öôÔ∏è</button>
</div>

<script>
Telegram.WebApp.expand();

let tx=JSON.parse(localStorage.getItem("tx")||"[]");
let cats=["–ü—Ä–æ–¥—É–∫—Ç—ã","–ï–¥–∞","–ö–æ—Ñ–µ","–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç","–¢–∞–∫—Å–∏","–¢–æ–ø–ª–∏–≤–æ","–û–¥–µ–∂–¥–∞","–û–±—É–≤—å","–ó–¥–æ—Ä–æ–≤—å–µ","–ê–ø—Ç–µ–∫–∞","–°–ø–æ—Ä—Ç","–ü–æ–¥–ø–∏—Å–∫–∏","–°–≤—è–∑—å","–ö–æ–º–º—É–Ω–∞–ª–∫–∞","–î–æ–º","–¢–µ—Ö–Ω–∏–∫–∞","–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è","–ü–æ–¥–∞—Ä–∫–∏","–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ","–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è"];
let type="income";
date.valueAsDate=new Date();

function tab(id){
 document.querySelectorAll("section").forEach(s=>s.style.display="none");
 document.getElementById(id).style.display="block";
 document.querySelectorAll(".bottom button").forEach(b=>b.classList.remove("active"));
 event.target.classList.add("active");
 if(id==="reports") draw();
 if(id==="dash") dash();
}

function openAdd(t){ tab("add"); setType(t); }

function setType(t){
 type=t;
 document.querySelectorAll(".toggle div").forEach(d=>d.classList.remove("active"));
 document.querySelector("."+t).classList.add("active");
 category.style.display=t==="expense"?"block":"none";
}

function saveTx(){
 tx.push({t:type,a:+amount.value,c:category.value,d:date.value});
 localStorage.setItem("tx",JSON.stringify(tx));
 amount.value="";
 tab("dash");
}

function dash(){
 let inc=0,exp=0;
 tx.forEach(x=>x.t==="income"?inc+=x.a:exp+=x.a);
 balance.innerText=inc-exp;
 incEl.innerText=inc;
 expEl.innerText=exp;
 last.innerHTML=tx.slice(-5).reverse().map(x=>`
  <div class="row">
   <span>${x.t==="income"?"–î–æ—Ö–æ–¥":x.c}</span>
   <b class="${x.t==="income"?"green":"red"}">${x.t==="income"?"+":"-"}${x.a}</b>
  </div>
 `).join("");
}

category.innerHTML=cats.map(c=>`<option>${c}</option>`).join("");
dash();

function toggleTheme(){
 document.body.classList.toggle("dark");
}
</script>

</body>
</html>
